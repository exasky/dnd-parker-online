<div class="d-flex flex-column flex-shrink-0">
  <button mat-raised-button
          class="flex-shrink-0 m-3"
          (click)="createUser()">
    <div class="d-flex align-items-center">
      <mat-icon class="mr-2">add</mat-icon>
      Create
    </div>
  </button>
  <div class="flex-grow overflow d-flex flex-column">
    <button mat-raised-button color="accent"
            *ngFor="let user of users"
            class="flex-shrink-0 m-3"
            (click)="selectUser(user)">
      {{user.username}}
    </button>
  </div>
</div>


<div class="flex-grow d-flex justify-content-center align-items-center flex-wrap">
  <mat-card class="m-3 h-75 w-lg-50 w-75 d-flex flex-column" *ngIf="selectedUser">
    <mat-card-header class="d-flex align-items-start flex-wrap">
      <mat-card-title>
        <div *ngIf="selectedUser.username">{{selectedUser.username}}</div>
        <div *ngIf="!selectedUser.username">New user</div>
      </mat-card-title>
      <div class="flex-grow d-flex justify-content-end" *ngIf="!isEdit">
        <button mat-raised-button (click)="editUser()">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-raised-button color="warn" class="mx-2" *ngIf="selectedUser.id" (click)="deleteUser()">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </div>
      <div class="flex-grow d-flex justify-content-end" *ngIf="isEdit">
        <button mat-raised-button (click)="cancel()">
          <mat-icon>undo</mat-icon>
          Cancel
        </button>
        <button mat-raised-button color="accent" class="mx-2" (click)="saveUser()">
          <mat-icon>save</mat-icon>
          Save
        </button>
        <button mat-raised-button color="warn" class="mx-2" *ngIf="selectedUser.id"
                (click)="resetPassword()">
          <mat-icon>vpn_key</mat-icon>
          Reset password
        </button>
      </div>
    </mat-card-header>
    <mat-card-content class="d-flex flex-column">
      <mat-form-field>
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="userEdit.username"
               placeholder="Username"
               required
               autocomplete="nope"
               [disabled]="!isEdit">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Password</mat-label>
        <input matInput [(ngModel)]="userEdit.password"
               placeholder="Password"
               type="password"
               required
               autocomplete="new-password"
               [disabled]="!isEdit">
      </mat-form-field>
      <mat-form-field>
        <mat-label>Role</mat-label>
        <mat-select [(ngModel)]="userEdit.role" [disabled]="!isEdit">
          <mat-option value="ROLE_GM">GM</mat-option>
          <mat-option value="ROLE_PLAYER">Player</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-list class="flex-grow overflow">
        <ng-container *ngFor="let campaign of campaigns; let index = index;">
          <div mat-subheader>{{campaign.name}}</div>
          <div class="d-flex flex-wrap justify-content-between">
            <mat-list-item *ngFor="let character of campaign.characters" style="width: unset">
              <mat-checkbox mat-line
                            [checked]="isCharacterSelected(character)"
                            (change)="toggleCharacterSelected($event, character)"
                            [disabled]="!isEdit">
                {{character.name}}
              </mat-checkbox>
            </mat-list-item>
            <mat-divider *ngIf="index !== campaigns.length - 1" style="position: relative !important;"></mat-divider>
          </div>
        </ng-container>
      </mat-list>
    </mat-card-content>
  </mat-card>
</div>
