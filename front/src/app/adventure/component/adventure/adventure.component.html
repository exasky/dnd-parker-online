<ng-container *ngIf="adventure">
  <div class="d-flex flex-column flex-shrink-0">

    <div class="d-flex">
      <div class="flex-1">
        <mat-form-field>
          <mat-select aria-label="Display grid lines" [(ngModel)]="options.displayGrid"
                      placeholder="Display grid lines"
                      (ngModelChange)="changedOptions()">
            <mat-option value="always">Always</mat-option>
            <mat-option value="onDrag&Resize">On Drag & Resize</mat-option>
            <mat-option value="none">None</mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-button (click)="saveAdventure()">Save (to remove websocket)</button>
      </div>
      <div class="flex-1 d-flex justify-content-center align-items-center">
        <h3>{{adventure.name}}</h3>
      </div>
      <div class="flex-1 d-flex justify-content-end align-items-center">
        <button mat-raised-button (click)="drawer.toggle()">Show characters</button>
      </div>
    </div>

    <app-adventure-item-displayer *ngIf="loginService.isGM"
                                  [layerElements]="addableLayerElements"></app-adventure-item-displayer>
  </div>

  <mat-drawer-container class="flex-grow d-flex">
    <mat-drawer-content class="flex-grow m-3" style="position: relative">
      <div [ngStyle]="{'width': gamePanelXSize * 700 + 'px',
                  'height': gamePanelYSize * 700 + 'px'}"
           class="overflow">
        <ng-template ngFor let-boardRow [ngForOf]="adventure.boards" let-rowIdx="index">
          <ng-template ngFor let-boardCol [ngForOf]="boardRow" let-colIdx="index">
            <img *ngIf="boardCol"
                 class="adventure-board-background"
                 [ngStyle]="{'top': 700 * rowIdx + 'px',
                      'left': 700 * colIdx + 'px',
                      'transform': 'rotate(' + boardCol.rotation + 'deg)'}"
                 [src]="'assets/board/' + boardCol.boardNumber + '.JPG'">
            <!--            <div *ngIf="boardCol" TODO replace div.background-image by img-->
            <!--                 [ngStyle]="{'top': 700 * rowIdx + 'px',-->
            <!--                      'left': 700 * colIdx + 'px',-->
            <!--                      'background-image': 'url(\'assets/board/' + boardCol.boardNumber + '.JPG\')',-->
            <!--                      'transform': 'rotate(' + boardCol.rotation + 'deg)'}"-->
            <!--                 class="adventure-board-background"></div>-->
          </ng-template>
        </ng-template>

        <gridster [options]="options" style="flex-grow: 1; z-index: 10">
          <gridster-item *ngFor="let item of dashboard"
                         [item]="item"
                         [ngSwitch]="item.type"
                         style="background: none !important;"
                         [ngbTooltip]="tipContent"
                         [container]="'body'"
                         #t="ngbTooltip"
                         (mousedown)="t.close()">

            <div *ngIf="!item.dragEnabled && item.type === layerElementType.CHARACTER"
                 class="adventure-board-item"
                 style="z-index: 5; background-color: rgba(0,0,0,0.5)">
            </div>

            <ng-template #tipContent [ngSwitch]="item.type">
              <ng-template [ngSwitchCase]="layerElementType.CHARACTER">
                <app-character-tooltip-displayer [character]="item.character"></app-character-tooltip-displayer>
                <!--                Hello, character <b>{{item.icon}}</b>!<br/>-->
                <!--                Hello, character <b>{{item.character.name}}</b>!-->
              </ng-template>
              <ng-template [ngSwitchCase]="layerElementType.MONSTER">
                Hello, monter <b>{{item.icon}}</b>!
              </ng-template>
              <div *ngSwitchDefault>
              </div>

            </ng-template>

            <div *ngSwitchCase="layerElementType.CHARACTER"
                 class="adventure-board-item"
                 [ngStyle]="{'background-image': 'url(\'assets/character/' + item.icon + '-token.jpg\')',
                              'transform': 'rotate(' + item.rotation + 'deg)'}">
            </div>

            <div *ngSwitchCase="layerElementType.MONSTER"
                 class="adventure-board-item"
                 [ngStyle]="{'background-image': 'url(\'assets/monster/' + item.icon + '-token.jpg\')',
                              'transform': 'rotate(' + item.rotation + 'deg)'}">
            </div>

            <div *ngSwitchDefault
                 class="adventure-board-item"
                 [ngStyle]="{'background-image': 'url(\'assets/item/' + item.icon + '\')',
                              'transform': 'rotate(' + item.rotation + 'deg)'}">
            </div>

            <button mat-mini-fab *ngIf="loginService.isGM" (mousedown)="removeItem(item, $event)">
              <mat-icon>delete</mat-icon>
            </button>
          </gridster-item>
        </gridster>
      </div>
    </mat-drawer-content>
    <mat-drawer #drawer mode="side" position="end">
      <div class="d-flex flex-column">
        <div *ngFor="let character of adventure.characters">
          {{character.name}} - {{character.maxMp}}
        </div>
      </div>
    </mat-drawer>
  </mat-drawer-container>
  <!--<mat-drawer-container>-->
  <!--  <mat-drawer-content>Main content</mat-drawer-content>-->
  <!--  <mat-drawer mode="side" opened>Drawer content</mat-drawer>-->
  <!--</mat-drawer-container>-->
</ng-container>
